
/* Merged Plone Javascript file
 * This file is dynamically assembled from separate parts.
 * Some of these parts have 3rd party licenses or copyright information attached
 * Such information is valid for that section,
 * not for the entire composite file
 * originating files are separated by - filename.js -
 */

/* - forms.js - */
// https://pleiades.stoa.org/portal_javascripts/forms.js?original=1
jQuery(function(){var p_url=portal_url[portal_url.length-1]!='/'?portal_url:portal_url.substring(0,portal_url.length-1)
var fetch_url=p_url+'/@@fetch-bibliographic-data';
function enable_zotero(){var $bib_uri_inputs=$('#archetypes-fieldname-array-fieldset-referenceCitations input[id$="\\|bibliographic_uri"]');$bib_uri_inputs.each(function(i,el){var count=("000"+i).slice(-3);var $bib_uri_input=$(el);if($bib_uri_input.siblings('button.BibInfoFetchButton').length){return}
var $lookup=$('<button class="BibInfoFetchButton" title="Fetch zotero data"><span>Fetch Zotero</span></button>');$bib_uri_input.after($lookup);$lookup.click(function(ev){var uri=$bib_uri_input.val();ev.preventDefault();if(uri){$.getJSON(fetch_url,{"url":uri},
function(data){if(data.error){alert(data.error);return}
var prefix='\\:'+count+'\\|';var $title=$bib_uri_input.parents().find('input[id$="'+prefix+'short_title"]');var $detail=$bib_uri_input.parents().find('input[id$="'+prefix+'citation_detail"]');var $formatted=$bib_uri_input.parents().find('input[id$="'+prefix+'formatted_citation"]');var $access_uri=$bib_uri_input.parents().find('input[id$="'+prefix+'access_uri"]');var title=data.short_title||data.title;if(title){$title.val(title)}
if(data.citation_detail){$detail.val(data.citation_detail)}
if(data.formatted_citation){$formatted.val(data.formatted_citation)}
if(data.access_uri&&!$access_uri.val()){$access_uri.val(data.access_uri)}
if(data.bibliographic_uri){$bib_uri_input.val(data.bibliographic_uri)}}).error(function(resp){try{var data=JSON.parse(resp.responseText);window.alert(data.error)} catch(err){window.alert('Error code: '+resp.status+' while retrieving Zotero response')}})}
return false})})}
enable_zotero();$('#archetypes-fieldname-referenceCitations').on('click','input.context[value="Add reference"]',enable_zotero);$('#archetypes-fieldname-referenceCitations').on('keyup','.short-title-wrapper input',
function(ev){var currentValue=ev.target.value;$button=$(ev.target).parent().parent().next();if(currentValue==""){$button.css("opacity","0.5")} else{$button.css("opacity","1");if(ev.keyCode==13){$button.click();ev.preventDefault();return false}}});const setIcon=(button,icon)=>{button.text(button.text().trim().replace(/^[^ ]* /,icon+' '))}
$('#archetypes-fieldname-referenceCitations').on('click','.short-title-wrapper .copy-zotero-uri',
function(ev){ev.preventDefault();if(ev.view&&ev.view.$button&&ev.view.$button[0]!==this){return}
$this=$(this);var $inputField=$this.parent("div.short-title-wrapper").find("input");var $resultDiv=$this.parent("div.short-title-wrapper").find(".zotero-api-result");var $bibliographicURIField=$this.closest("fieldset").find('input[id$="bibliographic_uri"]');var currentValue=$inputField.val();if(currentValue&&!$this.attr("data-fetching")){var url='https://api.zotero.org/groups/2533/items/top?limit=10&itemType=-attachment&q='+encodeURIComponent(currentValue);setIcon($this,"‚è≥");$this.css("opacity","0.5");$this.attr("data-fetching","true");$resultDiv.text("");fetch(url).then(function(response){return response.json()}).then(function(data){$this.attr("data-fetching","")
$this.css("opacity","1");setIcon($this,"üîΩ");if(data.length==1){$inputField.val(data[0].data.shortTitle);$bibliographicURIField.val(data[0].links.alternate.href);$resultDiv.css("background-color","white")} else if(data.length==0){$resultDiv.text("No results found searching for "+currentValue);$resultDiv.css("background-color","lightpink")} else{$resultDiv.html("Results found for <i>"+currentValue+"</i>:");$resultDiv.css("background-color","lightgrey");data.forEach(function(item){var item_url='https://www.zotero.org/groups/pleiades/items/'+item.key;var link_text='<a data-short-title="'+item.data.shortTitle+'" class="zotero-choice zotero-item-'+item.key;link_text+='" href="'+item_url+'">‚è≥'+(item.data.shortTitle||item.data.title)+'</a>'
$resultDiv[0].innerHTML+='<br />'+link_text;$.getJSON(fetch_url,{"url":item_url},
function(data){if(data.error){$(".zotero-item-"+item.key).css("color","red").attr("data-invalid","true");return}
$(".zotero-item-"+item.key).html(data.formatted_citation)}).fail(function(){markError($(".zotero-item-"+item.key))})})}}).catch(function(err){console.log('Fetch Error :-S',err)})}
return false});
function markError($link){$link.css("color","red").attr("data-invalid","true");var body=$link.html();$link.html(body.replace(/‚è≥/g,"‚ö†Ô∏è"))}
$('#archetypes-fieldname-referenceCitations').on("click","a.zotero-choice",
function(ev){ev.preventDefault();var $this=$(this);if($this.attr("data-invalid")){return false}
var $bibliographicURIField=$this.closest("fieldset").find('input[id$="bibliographic_uri"]');$bibliographicURIField.val($this.attr("href"));var $formattedCitationField=$this.closest("fieldset").find('input[id$="formatted_citation"]');$formattedCitationField.val($this.html());var $shortTitleField=$this.closest("div.short-title-wrapper").find("input");$shortTitleField.val($this.attr("data-short-title"));return false});var default_works=[];if(typeof(window.pleiades_default_works)!=='undefined'){default_works=Object.keys(pleiades_default_works)} else{console.error("pleiades_default_works is not defined")}
$("#archetypes-fieldname-referenceCitations").on('focusin','.short-title-wrapper input', function(){var $this=$(this);if(!$this.data('ui-autocomplete-initialized')){var $bibliographicURIField=$this.closest("fieldset").find('input[id$="bibliographic_uri"]');$this.autocomplete({source:[default_works],afterSelected: function(){$bibliographicURIField.val(pleiades_default_works[$this.val()])}});$this.data('ui-autocomplete-initialized',true);$this.focus()}})});

/* - jquery.autocomplete.js - */
// https://pleiades.stoa.org/portal_javascripts/jquery.autocomplete.js?original=1
(function($){'use strict';var ARROWLEFT=37,ARROWRIGHT=39,ARROWUP=38,ARROWDOWN=40,TAB=9,CTRLKEY=17,SHIFTKEY=16,DEL=46,ENTER=13,ESC=27,BACKSPACE=8,AKEY=65,CKEY=67,VKEY=86,ZKEY=90,YKEY=89,defaultSetting={},ctrlDown=false,shiftDown=false,publics={},accent_map={'·∫ö':'a','√Å':'a','√°':'a','√Ä':'a','√†':'a','ƒÇ':'a','ƒÉ':'a','·∫Æ':'a','·∫Ø':'a','·∫∞':'a','·∫±':'a','·∫¥':'a','·∫µ':'a','·∫≤':'a','·∫™':'a','·∫´':'a','·∫®':'a','·∫©':'a','«ç':'a','«é':'a','√Ö':'a','√•':'a','«∫':'a','«ª':'a','√Ñ':'a','√§':'a','«û':'a','«ü':'a','√É':'a','√£':'a','»¶':'a','»ß':'a','«†':'a','«°':'a','ƒÑ':'a','ƒÖ':'a','ƒÄ':'a','ƒÅ':'a','·∫¢':'a','·∫£':'a','»Ä':'a','»Å':'a','»Ç':'a','»É':'a','·∫†':'a','·∫°':'a','·∫∂':'a','·∫∑':'a','·∫¨':'a','·∫≠':'a','·∏Ä':'a','·∏Å':'a','»∫':'a','‚±•':'a','«º':'a','«Ω':'a','«¢':'a','«£':'a','·∏Ç':'b','·∏É':'b','·∏Ñ':'b','·∏Ö':'b','·∏Ü':'b','·∏á':'b','…É':'b','∆Ä':'b','·µ¨':'b','∆Å':'b','…ì':'b','∆Ç':'b','∆É':'b','ƒÜ':'c','ƒá':'c','ƒà':'c','ƒâ':'c','ƒå':'c','ƒç':'c','ƒä':'c','ƒã':'c','√á':'c','√ß':'c','·∏à':'c','·∏â':'c','»ª':'c','»º':'c','∆á':'c','∆à':'c','…ï':'c','ƒé':'d','ƒè':'d','·∏ä':'d','·∏ã':'d','·∏ê':'d','·∏ë':'d','·∏å':'d','·∏ç':'d','·∏í':'d','·∏ì':'d','·∏é':'d','·∏è':'d','ƒê':'d','ƒë':'d','·µ≠':'d','∆â':'d','…ñ':'d','∆ä':'d','…ó':'d','∆ã':'d','∆å':'d','»°':'d','√∞':'d','√â':'e','∆è':'e','∆é':'e','«ù':'e','√©':'e','√à':'e','√®':'e','ƒî':'e','ƒï':'e','√ä':'e','√™':'e','·∫æ':'e','·∫ø':'e','·ªÄ':'e','·ªÅ':'e','·ªÑ':'e','·ªÖ':'e','·ªÇ':'e','·ªÉ':'e','ƒö':'e','ƒõ':'e','√ã':'e','√´':'e','·∫º':'e','·∫Ω':'e','ƒñ':'e','ƒó':'e','»®':'e','»©':'e','·∏ú':'e','·∏ù':'e','ƒò':'e','ƒô':'e','ƒí':'e','ƒì':'e','·∏ñ':'e','·∏ó':'e','·∏î':'e','·∏ï':'e','·∫∫':'e','·∫ª':'e','»Ñ':'e','»Ö':'e','»Ü':'e','»á':'e','·∫∏':'e','·∫π':'e','·ªÜ':'e','·ªá':'e','·∏ò':'e','·∏ô':'e','·∏ö':'e','·∏õ':'e','…Ü':'e','…á':'e','…ö':'e','…ù':'e','·∏û':'f','·∏ü':'f','·µÆ':'f','∆ë':'f','∆í':'f','«¥':'g','«µ':'g','ƒû':'g','ƒü':'g','ƒú':'g','ƒù':'g','«¶':'g','«ß':'g','ƒ†':'g','ƒ°':'g','ƒ¢':'g','ƒ£':'g','·∏†':'g','·∏°':'g','«§':'g','«•':'g','∆ì':'g','…†':'g','ƒ§':'h','ƒ•':'h','»û':'h','»ü':'h','·∏¶':'h','·∏ß':'h','·∏¢':'h','·∏£':'h','·∏®':'h','·∏©':'h','·∏§':'h','·∏•':'h','·∏™':'h','·∏´':'h','H':'h','Ã±':'h','·∫ñ':'h','ƒ¶':'h','ƒß':'h','‚±ß':'h','‚±®':'h','√ç':'i','√≠':'i','√å':'i','√¨':'i','ƒ¨':'i','ƒ≠':'i','√é':'i','√Æ':'i','«è':'i','«ê':'i','√è':'i','√Ø':'i','·∏Æ':'i','·∏Ø':'i','ƒ®':'i','ƒ©':'i','ƒ∞':'i','i':'i','ƒÆ':'i','ƒØ':'i','ƒ™':'i','ƒ´':'i','·ªà':'i','·ªâ':'i','»à':'i','»â':'i','»ä':'i','»ã':'i','·ªä':'i','·ªã':'i','·∏¨':'i','·∏≠':'i','I':'i','ƒ±':'i','∆ó':'i','…®':'i','ƒ¥':'j','ƒµ':'j','J':'j','Ãå':'j','«∞':'j','»∑':'j','…à':'j','…â':'j',' ù':'j','…ü':'j',' Ñ':'j','·∏∞':'k','·∏±':'k','«®':'k','«©':'k','ƒ∂':'k','ƒ∑':'k','·∏≤':'k','·∏≥':'k','·∏¥':'k','·∏µ':'k','∆ò':'k','∆ô':'k','‚±©':'k','‚±™':'k','ƒπ':'a','ƒ∫':'l','ƒΩ':'l','ƒæ':'l','ƒª':'l','ƒº':'l','·∏∂':'l','·∏∑':'l','·∏∏':'l','·∏π':'l','·∏º':'l','·∏Ω':'l','·∏∫':'l','·∏ª':'l','≈Å':'l','≈Ç':'l','Ã£':'l','ƒø':'l','≈Ä':'l','»Ω':'l','∆ö':'l','‚±†':'l','‚±°':'l','‚±¢':'l','…´':'l','…¨':'l','…≠':'l','»¥':'l','·∏æ':'m','·∏ø':'m','·πÄ':'m','·πÅ':'m','·πÇ':'m','·πÉ':'m','…±':'m','≈É':'n','≈Ñ':'n','«∏':'n','«π':'n','≈á':'n','≈à':'n','√ë':'n','√±':'n','·πÑ':'n','·πÖ':'n','≈Ö':'n','≈Ü':'n','·πÜ':'n','·πá':'n','·πä':'n','·πã':'n','·πà':'n','·πâ':'n','∆ù':'n','…≤':'n','»†':'n','∆û':'n','…≥':'n','»µ':'n','N':'n','Ãà':'n','n':'n','√ì':'o','√≥':'o','√í':'o','√≤':'o','≈é':'o','≈è':'o','√î':'o','√¥':'o','·ªê':'o','·ªë':'o','·ªí':'o','·ªì':'o','·ªñ':'o','·ªó':'o','·ªî':'o','·ªï':'o','«ë':'o','«í':'o','√ñ':'o','√∂':'o','»™':'o','»´':'o','≈ê':'o','≈ë':'o','√ï':'o','√µ':'o','·πå':'o','·πç':'o','·πé':'o','·πè':'o','»¨':'o','»≠':'o','»Æ':'o','»Ø':'o','»∞':'o','»±':'o','√ò':'o','√∏':'o','«æ':'o','«ø':'o','«™':'o','«´':'o','«¨':'o','«≠':'o','≈å':'o','≈ç':'o','·πí':'o','·πì':'o','·πê':'o','·πë':'o','·ªé':'o','·ªè':'o','»å':'o','»ç':'o','»é':'o','»è':'o','∆†':'o','∆°':'o','·ªö':'o','·ªõ':'o','·ªú':'o','·ªù':'o','·ª†':'o','·ª°':'o','·ªû':'o','·ªü':'o','·ª¢':'o','·ª£':'o','·ªå':'o','·ªç':'o','·ªò':'o','·ªô':'o','∆ü':'o','…µ':'o','·πî':'p','·πï':'p','·πñ':'p','·πó':'p','‚±£':'p','∆§':'p','∆•':'p','P':'p','ÃÉ':'p','p':'p',' †':'q','…ä':'q','…ã':'q','≈î':'r','≈ï':'r','≈ò':'r','≈ô':'r','·πò':'r','·πô':'r','≈ñ':'r','≈ó':'r','»ê':'r','»ë':'r','»í':'r','»ì':'r','·πö':'r','·πõ':'r','·πú':'r','·πù':'r','·πû':'r','·πü':'r','…å':'r','…ç':'r','·µ≤':'r','…º':'r','‚±§':'r','…Ω':'r','…æ':'r','·µ≥':'r','√ü':'s','≈ö':'s','≈õ':'s','·π§':'s','·π•':'s','≈ú':'s','≈ù':'s','≈†':'s','≈°':'s','·π¶':'s','·πß':'s','·π†':'s','·π°':'s','·∫õ':'s','≈û':'s','≈ü':'s','·π¢':'s','·π£':'s','·π®':'s','·π©':'s','»ò':'s','»ô':'s',' Ç':'s','S':'s','Ã©':'s','s':'s','√û':'t','√æ':'t','≈§':'t','≈•':'t','T':'t','·∫ó':'t','·π™':'t','·π´':'t','≈¢':'t','≈£':'t','·π¨':'t','·π≠':'t','»ö':'t','»õ':'t','·π∞':'t','·π±':'t','·πÆ':'t','·πØ':'t','≈¶':'t','≈ß':'t','»æ':'t','‚±¶':'t','·µµ':'t','∆´':'t','∆¨':'t','∆≠':'t','∆Æ':'t',' à':'t','»∂':'t','√ö':'u','√∫':'u','√ô':'u','√π':'u','≈¨':'u','≈≠':'u','√õ':'u','√ª':'u','«ì':'u','«î':'u','≈Æ':'u','≈Ø':'u','√ú':'u','√º':'u','«ó':'u','«ò':'u','«õ':'u','«ú':'u','«ô':'u','«ö':'u','«ï':'u','«ñ':'u','≈∞':'u','≈±':'u','≈®':'u','≈©':'u','·π∏':'u','·ππ':'u','≈≤':'u','≈≥':'u','≈™':'u','≈´':'u','·π∫':'u','·πª':'u','·ª¶':'u','·ªß':'u','»î':'u','»ï':'u','»ñ':'u','»ó':'u','∆Ø':'u','∆∞':'u','·ª®':'u','·ª©':'u','·ª™':'u','·ª´':'u','·ªÆ':'u','·ªØ':'u','·ª¨':'u','·ª≠':'u','·ª∞':'u','·ª±':'u','·ª§':'u','·ª•':'u','·π≤':'u','·π≥':'u','·π∂':'u','·π∑':'u','·π¥':'u','·πµ':'u','…Ñ':'u',' â':'u','·πº':'v','·πΩ':'v','·πæ':'v','·πø':'v','∆≤':'v',' ã':'v','·∫Ç':'w','·∫É':'w','·∫Ä':'w','·∫Å':'w','≈¥':'w','≈µ':'w','W':'w','Ãä':'w','·∫ò':'w','·∫Ñ':'w','·∫Ö':'w','·∫Ü':'w','·∫á':'w','·∫à':'w','·∫â':'w','·∫å':'x','·∫ç':'x','·∫ä':'x','·∫ã':'x','√ù':'y','√Ω':'y','·ª≤':'y','·ª≥':'y','≈∂':'y','≈∑':'y','Y':'y','·∫ô':'y','≈∏':'y','√ø':'y','·ª∏':'y','·ªπ':'y','·∫é':'y','·∫è':'y','»≤':'y','»≥':'y','·ª∂':'y','·ª∑':'y','·ª¥':'y','·ªµ':'y',' è':'y','…é':'y','…è':'y','∆≥':'y','∆¥':'y','≈π':'z','≈∫':'z','·∫ê':'z','·∫ë':'z','≈Ω':'z','≈æ':'z','≈ª':'z','≈º':'z','·∫í':'z','·∫ì':'z','·∫î':'z','·∫ï':'z','∆µ':'z','∆∂':'z','»§':'z','»•':'z',' ê':'z',' ë':'z','‚±´':'z','‚±¨':'z','«Æ':'z','«Ø':'z','∆∫':'z','Ôºí':'2','Ôºñ':'6','Ôº¢':'B','Ôº¶':'F','Ôº™':'J','ÔºÆ':'N','Ôº≤':'R','Ôº∂':'V','Ôº∫':'Z','ÔΩÇ':'b','ÔΩÜ':'f','ÔΩä':'j','ÔΩé':'n','ÔΩí':'r','ÔΩñ':'v','ÔΩö':'z','Ôºë':'1','Ôºï':'5','Ôºô':'9','Ôº°':'A','Ôº•':'E','Ôº©':'I','Ôº≠':'M','Ôº±':'Q','Ôºµ':'U','Ôºπ':'Y','ÔΩÅ':'a','ÔΩÖ':'e','ÔΩâ':'i','ÔΩç':'m','ÔΩë':'q','ÔΩï':'u','ÔΩô':'y','Ôºê':'0','Ôºî':'4','Ôºò':'8','Ôº§':'D','Ôº®':'H','Ôº¨':'L','Ôº∞':'P','Ôº¥':'T','Ôº∏':'X','ÔΩÑ':'d','ÔΩà':'h','ÔΩå':'l','ÔΩê':'p','ÔΩî':'t','ÔΩò':'x','Ôºì':'3','Ôºó':'7','Ôº£':'C','Ôºß':'G','Ôº´':'K','ÔºØ':'O','Ôº≥':'S','Ôº∑':'W','ÔΩÉ':'c','ÔΩá':'g','ÔΩã':'k','ÔΩè':'o','ÔΩì':'s','ÔΩó':'w','·∫≥':'a','√Ç':'a','√¢':'a','·∫§':'a','·∫•':'a','·∫¶':'a','·∫ß':'a'};if(window.getComputedStyle===undefined){window.getComputedStyle=(function(){
function getPixelSize(element,style,property,fontSize){var sizeWithSuffix=style[property],size=parseFloat(sizeWithSuffix),suffix=sizeWithSuffix.split(/\d/)[0],rootSize;fontSize=fontSize!==null?fontSize:/%|em/.test(suffix)&&element.parentElement?getPixelSize(element.parentElement,element.parentElement.currentStyle,'fontSize',null):16;rootSize=property==='fontSize'?fontSize:/width/i.test(property)?element.clientWidth:element.clientHeight;return(suffix==='em')?size * fontSize:(suffix==='in')?size * 96:(suffix==='pt')?size * 96/ 72 : (suffix === '%') ? size / 100 * rootSize:size}
function setShortStyleProperty(style,property){var borderSuffix=property==='border'?'Width':'',t=property+'Top'+borderSuffix,r=property+'Right'+borderSuffix,b=property+'Bottom'+borderSuffix,l=property+'Left'+borderSuffix;style[property]=(style[t]===style[r]===style[b]===style[l]?[style[t]]:style[t]===style[b]&&style[l]===style[r]?[style[t],style[r]]:style[l]===style[r]?[style[t],style[r],style[b]]:[style[t],style[r],style[b],style[l]]).join(' ')}
function CSSStyleDeclaration(element){var currentStyle=element.currentStyle,style=this,property,fontSize=getPixelSize(element,currentStyle,'fontSize',null);for(property in currentStyle){if(Object.prototype.hasOwnProperty.call(currentStyle,property)){if (/width|height|margin.|padding.|border.+W/.test(property)&&style[property]!=='auto'){style[property]=getPixelSize(element,currentStyle,property,fontSize)+'px'} else if(property==='styleFloat'){style.float=currentStyle[property]} else{style[property]=currentStyle[property]}}}
setShortStyleProperty(style,'margin');setShortStyleProperty(style,'padding');setShortStyleProperty(style,'border');style.fontSize=fontSize+'px';return style}
CSSStyleDeclaration.prototype={constructor:CSSStyleDeclaration,getPropertyPriority: function(){},getPropertyValue: function(prop){return this[prop]||''},item: function(){},removeProperty: function(){},setProperty: function(){},getPropertyCSSValue: function(){}};
function getComputedStyle(element){return new CSSStyleDeclaration(element)}
return getComputedStyle}(this))}
$(document).on('keydown.xdsoftctrl', function(e){if(e.keyCode===CTRLKEY){ctrlDown=true}
if(e.keyCode===SHIFTKEY){ctrlDown=true}}).on('keyup.xdsoftctrl', function(e){if(e.keyCode===CTRLKEY){ctrlDown=false}
if(e.keyCode===SHIFTKEY){ctrlDown=false}});
function accentReplace(s){if(!s){return ''}
var ret='',i;for(i=0;i<s.length;i+=1){ret+=accent_map[s.charAt(i)]||s.charAt(i)}
return ret}
function escapeRegExp(str){return str.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}
function getCaretPosition(input){if(!input){return}
if(input.selectionStart){return input.selectionStart}
if(document.selection){input.focus();var sel=document.selection.createRange(),selLen=document.selection.createRange().text.length;sel.moveStart('character',-input.value.length);return sel.text.length-selLen}}
function setCaretPosition(input,pos){if(input.setSelectionRange){input.focus();input.setSelectionRange(pos,pos)} else if(input.createTextRange){var range=input.createTextRange();range.collapse(true);range.moveEnd('character',pos);range.moveStart('character',pos);range.select()}}
function isset(value){return value!==undefined}
function safe_call(callback,args,callback2,defaultValue){if(isset(callback)&&!$.isArray(callback)){return $.isFunction(callback)?callback.apply(this,args):defaultValue}
if(isset(callback2)){return safe_call.call(this,callback2,args)}
return defaultValue};
function __safe(callbackName,source,args,defaultValue){var undefinedVar;return safe_call.call(this,(isset(this.source[source])&&Object.prototype.hasOwnProperty.call(this.source[source],callbackName))?this.source[source][callbackName]:undefinedVar,args, function(){return safe_call.call(this,isset(this[callbackName][source])?this[callbackName][source]:(isset(this[callbackName][0])?this[callbackName][0]:(Object.prototype.hasOwnProperty.call(this,callbackName)?this[callbackName]:undefinedVar)),args,defaultSetting[callbackName][source]||defaultSetting[callbackName][0]||defaultSetting[callbackName],defaultValue)},defaultValue)};
function __get(property,source){if(!isset(source))
source=0;if($.isArray(this.source)&&isset(this.source[source])&&isset(this.source[source][property]))
return this.source[source][property];if(isset(this[property])){if($.isArray(this[property])){if(isset(this[property][source]))
return this[property][source];if(isset(this[property][0]))
return this[property][0];return null}
return this[property]}
return null};
function loadRemote(url,sourceObject,done,debug){if(sourceObject.xhr){sourceObject.xhr.abort()}
sourceObject.xhr=$.ajax($.extend(true,{url:url,type:'GET',async:true,cache:false,dataType:'json'},sourceObject.ajax)).done(function(data){done&&done.apply(this,$.makeArray(arguments))}).fail(function(jqXHR,textStatus){if(debug)
console.log("Request failed: "+textStatus)})}
function findRight(data,query){var right=false,source;for(source=0;source<data.length;source+=1){if(right=__safe.call(this,"findRight",source,[data[source],query,source])){return{right:right,source:source}}}
return false}
function processData(data,query){var source;preparseData.call(this,data,query);for(source=0;source<data.length;source+=1){data[source]=__safe.call(this,'filter',source,[data[source],query,source],data[source])}};
function collectData(query,datasource,callback){var options=this,source;if($.isFunction(options.source)){options.source.apply(options,[query,function(items){datasource=[items];safe_call.call(options,callback,[query])},datasource,0])}else{for(source=0;source<options.source.length;source+=1){if($.isArray(options.source[source])){datasource[source]=options.source[source]} else if($.isFunction(options.source[source])){(function(source){options.source[source].apply(options,[query, function(items){if(!datasource[source]){datasource[source]=[]}
if(items&&$.isArray(items)){switch(options.appendMethod){case 'replace':datasource[source]=items;break;default:datasource[source]=datasource[source].concat(items)}}
safe_call.call(options,callback,[query])},datasource,source])}(source))} else{switch(options.source[source].type){case 'remote':if(isset(options.source[source].url)){if(!isset(options.source[source].minLength)||query.length>=options.source[source].minLength){var url=__safe.call(options,'replace',source,[options.source[source].url,query],'');if(!datasource[source]){datasource[source]=[]}(function(source){loadRemote(url,options.source[source], function(resp){datasource[source]=resp;safe_call.call(options,callback,[query])},options.debug)}(source))}}
break;default:if(isset(options.source[source]['data'])){datasource[source]=options.source[source]['data']}else{datasource[source]=options.source[source]}}}}}
safe_call.call(options,callback,[query])};
function preparseData(data,query){for(var source=0;source<data.length;source++){data[source]=__safe.call(this,'preparse',source,[data[source],query],data[source])}};
function renderData(data,query){var source,i,$div,$divs=[];for(source=0;source<data.length;source+=1){for(i=0;i<data[source].length;i+=1){if($divs.length>=this.limit)
break;$div=$(__safe.call(this,'render',source,[data[source][i],source,i,query],''));$div.data('source',source);$div.data('pid',i);$div.data('item',data[source][i]);$divs.push($div)}}
return $divs};
function getItem($div,dataset){if(isset($div.data('source'))&&isset($div.data('pid'))&&isset(dataset[$div.data('source')])&&isset(dataset[$div.data('source')][$div.data('pid')])){return dataset[$div.data('source')][$div.data('pid')]}
return false};
function getValue($div,dataset){var item=getItem($div,dataset);if(item){return __safe.call(this,'getValue',$div.data('source'),[item,$div.data('source')])}else{if(isset($div.data('value'))){return decodeURIComponent($div.data('value'))}else{return $div.html()}}};defaultSetting={minLength:0,valueKey:'value',titleKey:'title',highlight:true,showHint:true,dropdownWidth:'100%',dropdownStyle:{},itemStyle:{},hintStyle:false,style:false,debug:true,openOnFocus:false,closeOnBlur:true,autoselect:false,accents:true,replaceAccentsForRemote:true,limit:20,visibleLimit:20,visibleHeight:0,defaultHeightItem:30,timeoutUpdate:10,get: function(property,source){return __get.call(this,property,source)},replace:[
function(url,query){if(this.replaceAccentsForRemote){query=accentReplace(query)}
return url.replace('%QUERY%',encodeURIComponent(query))}],equal:function(value,query){return query.toLowerCase()==value.substr(0,query.length).toLowerCase()},findRight:[
function(items,query,source){var results=[],value='',i;if(items){for(i=0;i<items.length;i+=1){value=__safe.call(this,'getValue',source,[items[i],source]);if(__safe.call(this,'equal',source,[value,query,source],false)){return items[i]}}}
return false}],valid:[
function(value,query){if(this.accents){value=accentReplace(value);query=accentReplace(query)}
return value.toLowerCase().indexOf(query.toLowerCase())!=-1}],filter:[
function(items,query,source){var results=[],value='',i;if(items){for(i=0;i<items.length;i+=1){value=isset(items[i][this.get('valueKey',source)])?items[i][this.get('valueKey',source)]:items[i].toString();if(__safe.call(this,'valid',source,[value,query])){results.push(items[i])}}}
return results}],preparse:function(items){return items},getValue:[
function(item,source){return isset(item[this.get('valueKey',source)])?item[this.get('valueKey',source)]:item.toString()}],getTitle:[
function(item,source){return isset(item[this.get('titleKey',source)])?item[this.get('titleKey',source)]:item.toString()}],render:[
function(item,source,pid,query){var value=__safe.call(this,"getValue",source,[item,source],defaultSetting.getValue[0].call(this,item,source)),title=__safe.call(this,"getTitle",source,[item,source],defaultSetting.getTitle[0].call(this,item,source)),_value='',_query='',_title='',hilite_hints='',highlighted='',c,h,i,spos=0;if(this.highlight){if(!this.accents){title=title.replace(new RegExp('('+escapeRegExp(query)+')','i'),'<b>$1</b>')}else{_title=accentReplace(title).toLowerCase().replace(/[<>]+/g,''),_query=accentReplace(query).toLowerCase().replace(/[<>]+/g,'');hilite_hints=_title.replace(new RegExp(escapeRegExp(_query),'g'),'<'+_query+'>');for(i=0;i<hilite_hints.length;i+=1){c=title.charAt(spos);h=hilite_hints.charAt(i);if(h==='<'){highlighted+='<b>'} else if(h==='>'){highlighted+='</b>'} else{spos+=1;highlighted+=c}}
title=highlighted}}
return '<div '+(value==query?'class="active"':'')+' data-value="'+encodeURIComponent(value)+'">'+title+'</div>'}],appendMethod:'concat',source:[],afterSelected: function(){}};
function init(that,options){if($(that).hasClass('xdsoft_input'))
return;var $box=$('<div class="xdsoft_autocomplete"></div>'),$dropdown=$('<div class="xdsoft_autocomplete_dropdown"></div>'),$hint=$('<input readonly class="xdsoft_autocomplete_hint"/>'),$input=$(that),timer1=0,intervalForVisibility,dataset=[],iOpen=false,value='',currentValue='',currentSelect='',active=null,pos=0;$input.data('autocomplete_options',options);$dropdown.on('mousedown', function(e){e.preventDefault();e.stopPropagation()}).on('updatescroll.xdsoft', function(){var _act=$dropdown.find('.active');if(!_act.length){return}
var top=_act.position().top,actHght=_act.outerHeight(true),scrlTop=$dropdown.scrollTop(),hght=$dropdown.height();if(top<0){$dropdown.scrollTop(scrlTop-Math.abs(top))} else if(top+actHght>hght){$dropdown.scrollTop(scrlTop+top+actHght-hght)}});$box.css({'display':$input.css('display'),});if(options.style)
$box.css(options.style);$input.addClass('xdsoft_input').attr('autocomplete','off');var xDown=null;var yDown=null;var isSwipe=false;$dropdown.on('mousemove','div',function(){if($(this).hasClass('active'))
return true;$dropdown.find('div').removeClass('active');$(this).addClass('active')}).on('mousedown','div',function(e){$dropdown.find('div').removeClass('active');$(this).addClass('active');$input.trigger('pick.xdsoft')}).on('touchstart','div',function(e){xDown=e.originalEvent.touches[0].clientX;yDown=e.originalEvent.touches[0].clientY}).on('touchend','div',function(e){if(isSwipe===false){$dropdown.find('div').removeClass('active');$(this).addClass('active');$input.trigger('pick.xdsoft')}
isSwipe=false}).on('touchmove','div',function(e){if(!xDown||!yDown){return}
var xUp=e.originalEvent.touches[0].clientX;var yUp=e.originalEvent.touches[0].clientY;var xDiff=xDown-xUp;var yDiff=yDown-yUp;if(Math.abs(xDiff)>Math.abs(yDiff)){if(xDiff>0){isSwipe='left'} else{isSwipe='right'}} else{if(yDiff>0){isSwipe='top'} else{isSwipe='bottm'}}
xDown=null;yDown=null});
function manageData(){if($input.val()!=currentValue){currentValue=$input.val()} else{return}
if(currentValue.length<options.minLength){$input.trigger('close.xdsoft');return}
collectData.call(options,currentValue,dataset,function(query){if(query!=currentValue){return}
var right;processData.call(options,dataset,query);$input.trigger('updateContent.xdsoft');if(options.showHint&&currentValue.length&&currentValue.length<=$input.prop('size')&&(right=findRight.call(options,dataset,currentValue))){var title=__safe.call(options,'getTitle',right.source,[right.right,right.source]);title=query+title.substr(query.length);$hint.val(title)} else{$hint.val('')}});return}
function manageKey(event){var key=event.keyCode,right;switch(key){case AKEY:case CKEY:case VKEY:case ZKEY:case YKEY:if(event.shiftKey||event.ctrlKey){return true}
break;case SHIFTKEY:case CTRLKEY:return true;break;case ARROWRIGHT:case ARROWLEFT:if(ctrlDown||shiftDown||event.shiftKey||event.ctrlKey){return true}
value=$input.val();pos=getCaretPosition($input[0]);if(key===ARROWRIGHT&&pos===value.length){if(right=findRight.call(options,dataset,value)){$input.trigger('pick.xdsoft',[__safe.call(options,'getValue',right.source,[right.right,right.source])])} else{$input.trigger('pick.xdsoft')}
event.preventDefault();return false}
return true;case TAB:return true;case ENTER:if(iOpen){if(options.autoselect){$input.trigger('pick.xdsoft')} else if(!options.autoselect&&active){$input.trigger('pick.xdsoft')} else{$input.trigger('close.xdsoft');return true}
event.preventDefault();return false} else{return true}
break;case ESC:$input.val(currentValue).trigger('close.xdsoft');event.preventDefault();return false;case ARROWDOWN:case ARROWUP:if(!iOpen){$input.trigger('open.xdsoft');$input.trigger('updateContent.xdsoft');event.preventDefault();return false}
active=$dropdown.find('div.active');var next=key==ARROWDOWN?'next':'prev',timepick=true;if(active.length){active.removeClass('active');if(active[next]().length){active[next]().addClass('active')}else{$input.val(currentValue);timepick=false}}else{$dropdown.children().eq(key==ARROWDOWN?0:-1).addClass('active')}
if(timepick){$input.trigger('timepick.xdsoft')}
$dropdown.trigger('updatescroll.xdsoft');event.preventDefault();return false}
return}
$input.data('xdsoft_autocomplete',dataset).after($box).on('pick.xdsoft', function(event,_value){$input.trigger('timepick.xdsoft',_value);currentSelect=currentValue=$input.val();$input.trigger('close.xdsoft');active=$dropdown.find('div.active').eq(0);if(!active.length)
active=$dropdown.children().first();$input.trigger('selected.xdsoft',[getItem(active,dataset)]);if(options.afterSelected)
options.afterSelected()}).on('timepick.xdsoft', function(event,_value){active=$dropdown.find('div.active');if(!active.length)
active=$dropdown.children().first();if(active.length){if(!isset(_value)){$input.val(getValue.call(options,active,dataset))}else{$input.val(_value)}
$input.trigger('autocompleted.xdsoft',[getItem(active,dataset)]);$hint.val('');setCaretPosition($input[0],$input.val().length)}}).on('keydown.xdsoft input.xdsoft cut.xdsoft paste.xdsoft', function(event){var ret=manageKey(event);if(ret===false||ret===true){return ret}
setTimeout(function(){manageData()},1);manageData()}).on('change.xdsoft', function(event){currentValue=$input.val()});currentValue=$input.val();collectData.call(options,$input.val(),dataset,function(query){processData.call(options,dataset,query)});if(options.openOnFocus){$input.on('focusin.xdsoft',function(){$input.trigger('open.xdsoft');$input.trigger('updateContent.xdsoft')})}
if(options.closeOnBlur)
$input.on('focusout.xdsoft',function(){$input.trigger('close.xdsoft')});$box.append($input).append($dropdown);var olderBackground=false,timerUpdate=0;$input.on('updateHelperPosition.xdsoft',function(){clearTimeout(timerUpdate);timerUpdate=setTimeout(function(){$box.css({'display':$input.css('display'),'width':$input.css('width')});$dropdown.css($.extend(true,{left:$input.position().left,top:$input.position().top+parseInt($input.css('marginTop'))+parseInt($input[0].offsetHeight),marginLeft:$input.css('marginLeft'),marginRight:$input.css('marginRight'),width:options.dropdownWidth=='100%'?$input[0].offsetWidth:options.dropdownWidth},options.dropdownStyle));if(options.showHint){var style=getComputedStyle($input[0],"");$hint[0].style.cssText=style.cssText;$hint.css({'box-sizing':style.boxSizing,borderStyle:'solid',borderCollapse:style.borderCollapse,borderLeftWidth:style.borderLeftWidth,borderRightWidth:style.borderRightWidth,borderTopWidth:style.borderTopWidth,borderBottomWidth:style.borderBottomWidth,paddingBottom:style.paddingBottom,marginBottom:style.marginBottom,paddingTop:style.paddingTop,marginTop:style.marginTop,paddingLeft:style.paddingLeft,marginLeft:style.marginLeft,paddingRight:style.paddingRight,marginRight:style.marginRight,maxHeight:style.maxHeight,minHeight:style.minHeight,maxWidth:style.maxWidth,minWidth:style.minWidth,width:style.width,letterSpacing:style.letterSpacing,lineHeight:style.lineHeight,outlineWidth:style.outlineWidth,fontFamily:style.fontFamily,fontVariant:style.fontVariant,fontStyle:$input.css('fontStyle'),fontSize:$input.css('fontSize'),fontWeight:$input.css('fontWeight'),flex:style.flex,justifyContent:style.justifyContent,borderRadius:style.borderRadius,'-webkit-box-shadow':'none','box-shadow':'none'});$input.css('font-size',$input.css('fontSize'))
$hint.innerHeight($input.innerHeight());$hint.css($.extend(true,{position:'absolute',zIndex:'1',borderColor:'transparent',outlineColor:'transparent',left:$input.position().left,top:$input.position().top,background:$input.css('background')},options.hintStyle));try{$input[0].style.setProperty('background','transparent','important')} catch(e){$input.css('background','transparent')}
$box.append($hint)}},options.timeoutUpdate||1)});if($input.is(':visible')){$input.trigger('updateHelperPosition.xdsoft')} else{intervalForVisibility=setInterval(function(){if($input.is(':visible')){$input.trigger('updateHelperPosition.xdsoft');clearInterval(intervalForVisibility)}},100)}
$(window).on('resize',function(){$box.css({'width':'auto'});$input.trigger('updateHelperPosition.xdsoft')})
$input.on('close.xdsoft',function(){if(!iOpen){return}
$dropdown.hide();$hint.val('');if(!options.autoselect){$input.val(currentValue)}
iOpen=false}).on('updateContent.xdsoft',function(){var out=renderData.call(options,dataset,$input.val()),hght=10;if(out.length){$input.trigger('open.xdsoft')} else{$input.trigger('close.xdsoft');return}
$dropdown.html("");$(out).each(function(){this.css($.extend(true,{paddingLeft:$input.css('paddingLeft'),paddingRight:$input.css('paddingRight')},options.itemStyle));$dropdown.append(this)});if(options.visibleHeight){hght=options.visibleHeight} else{hght=options.visibleLimit *((out[0]?out[0].outerHeight(true):0)||options.defaultHeightItem)+5}
$dropdown.css('maxHeight',hght+'px')}).on('open.xdsoft',function(){if(iOpen)
return;$dropdown.show();iOpen=true}).on('destroy.xdsoft',function(){$input.removeClass('xdsoft');$box.after($input);$box.remove();clearTimeout(timer1);clearTimeout(intervalForVisibility);$input.data('xdsoft_autocomplete',null);$input.off('.xdsoft')})};publics={destroy: function(){return this.trigger('destroy.xdsoft')},update: function(){return this.trigger('updateHelperPosition.xdsoft')},options: function(_options){if(this.data('autocomplete_options')&&$.isPlainObject(_options)){this.data('autocomplete_options',$.extend(true,this.data('autocomplete_options'),_options))}
return this},setSource: function(_newsource,id){if(this.data('autocomplete_options')&&($.isPlainObject(_newsource)||$.isFunction(_newsource)||$.isArray(_newsource))){var options=this.data('autocomplete_options'),dataset=this.data('xdsoft_autocomplete'),source=options.source;if(id!==undefined&&!isNaN(id)){if($.isPlainObject(_newsource)||$.isArray(_newsource)){source[id]=$.extend(true,$.isArray(_newsource)?[]:{},_newsource)} else{source[id]=_newsource}} else{if($.isFunction(_newsource)){this.data('autocomplete_options').source=_newsource} else{$.extend(true,source,_newsource)}}
collectData.call(options,this.val(),dataset,function(query){processData.call(options,dataset,query)})}
return this},getSource: function(id){if(this.data('autocomplete_options')){var source=this.data('autocomplete_options').source;if(id!==undefined&&!isNaN(id)&&source[id]){return source[id]} else{return source}}
return null}};$.fn.autocomplete=function(_options,_second,_third){if($.type(_options)==='string'&&publics[_options]){return publics[_options].call(this,_second,_third)}
return this.each(function(){var options=$.extend(true,{},defaultSetting,_options);init(this,options)})}}(jQuery));
